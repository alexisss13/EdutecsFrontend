<div class="w-full max-w-7xl mx-auto pb-12">

  <div *ngIf="!mostrarResultados" class="flex flex-col lg:flex-row gap-8 items-start animate-fade-in">
    
    <div class="w-full lg:w-2/3 flex flex-col gap-5">
      
      <app-instructions class="block w-full"></app-instructions>

      <div class="px-2 mt-4">
        <h2 class="text-xl font-bold text-gray-800 tracking-tight">Configura tu Actividad</h2>
        <p class="text-sm text-gray-500">Define los par√°metros para filtrar las mejores estrategias.</p>
      </div>

      <div
        class="group relative bg-white rounded-2xl transition-all duration-300 ease-out border border-transparent"
        *ngFor="let pregunta of getPreguntasParaMostrar(); let i = index"
        [ngClass]="{ 
          'shadow-lg shadow-blue-900/5 ring-1 ring-black/5': !isExpanded(i),
          'shadow-xl shadow-blue-900/10 ring-2 ring-primary offset-2': isExpanded(i)
        }"
      >
        <div
          class="flex items-center gap-4 p-4 cursor-pointer select-none rounded-2xl transition-colors duration-200"
          [ngClass]="isExpanded(i) ? 'bg-white' : 'hover:bg-gray-50'"
          (click)="togglePanel(i)"
        >
          <div 
            class="w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-300 shrink-0"
            [ngClass]="isExpanded(i) ? ' text-white shadow-md shadow-primary/30 rotate-3' : 'bg-blue-50 text-primary group-hover:scale-105'"
          >
            <img *ngIf="pregunta.icono" [src]="pregunta.icono" class="w-6 h-6 object-contain" alt="Icono" />
            <svg *ngIf="!pregunta.icono && pregunta.esOtrasOpciones" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
          </div>
          <div class="flex-1 flex flex-col justify-center">
            <span class="text-sm font-semibold text-gray-700 group-hover:text-primary transition-colors">
              {{ pregunta.texto }}
            </span>
            <span *ngIf="!isExpanded(i) && getSeleccionParaPregunta(pregunta.texto)" class="text-xs text-gray-400 truncate max-w-[200px]">
               {{ getSeleccionParaPregunta(pregunta.texto) }}
            </span>
          </div>
          <div class="w-8 h-8 flex items-center justify-center rounded-full border border-gray-100 bg-white shadow-sm text-gray-400 transition-all duration-300 group-hover:border-primary/30"
               [ngClass]="{ 'rotate-180 bg-primary  border-transparent': isExpanded(i) }">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7" /></svg>
          </div>
        </div>

        <div *ngIf="isExpanded(i)" class="px-4 pb-4 pt-0 animate-fadeIn">
          <div class="h-px w-full bg-gray-100 mb-4 mx-auto"></div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
             <div
              class="relative p-3 rounded-xl border transition-all duration-200 cursor-pointer flex items-center gap-3 group/option"
              *ngFor="let opcion of pregunta.opciones"
              (click)="selectOpcion(pregunta, opcion)"
              [ngClass]="{
                'border-primary bg-blue-50/50 shadow-inner': isOpcionSeleccionada(pregunta, opcion),
                'border-gray-100 bg-white hover:border-primary/40 hover:shadow-md hover:-translate-y-0.5': !isOpcionSeleccionada(pregunta, opcion)
              }"
            >
              <div 
                class="w-5 h-5 rounded-full border flex items-center justify-center transition-all duration-200 shrink-0"
                [ngClass]="isOpcionSeleccionada(pregunta, opcion) ? 'border-primary bg-primary' : 'border-gray-300 bg-gray-50 group-hover/option:border-primary'"
              >
                <svg *ngIf="isOpcionSeleccionada(pregunta, opcion)" class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
              </div>
              <span 
                class="text-sm font-medium leading-tight transition-colors"
                [ngClass]="isOpcionSeleccionada(pregunta, opcion) ? 'text-primary' : 'text-gray-600 group-hover/option:text-gray-900'"
              >
                {{ opcion.nombre }}
              </span>
            </div>
          </div>
        </div>
      </div>
      </div>

    <div class="w-full lg:w-1/3">
      <app-result-panel 
        (buscarActividad)="onBuscar()">
      </app-result-panel>
    </div>
  </div>

  <div *ngIf="mostrarResultados" class="w-full">
    <app-result-activite 
      (nuevaBusqueda)="onResetBusqueda()">
    </app-result-activite>
  </div>

</div>